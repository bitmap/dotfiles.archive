#!/usr/bin/env bash

cd "$(dirname "${BASH_SOURCE}")";

function dotfiles() {
	dotfiles=~/.dotfiles
	files=".bashrc .bash_profile .vimrc .vim .gitconfig .gitignore .nvm/default-packages"

	for file in $files; do
		# create if doesn't exist
		if [ -e "$file" ]; then
			touch ~/$file
		fi

		# remove old version
		rm -r ~/$file

		# make new symlink
    echo "Creating symlink to $file..."
    ln -s $dotfiles/$file ~/$file
	done

	# symlink vscode if it's istalled
	vscode_macos=~/"Library/Application Support/Code/User/settings.json"
	vscode_linux=~/.config/Code/User/settings.json

	echo "Creating symlink to VS Code settings..."
	if [ -f "$vscode_macos" ]; then
		rm "$vscode_macos"
		ln -s $dotfiles/.vscode/settings.json "$vscode_macos"
	elif [ -f "$vscode_linux" ]; then
		rm "$vscode_linux"
		ln -s $dotfiles/.vscode/settings.json "$vscode_linux"
	else echo "Can't find VS Code settings"
	fi

	touch ~/.hushlogin
	source ~/.bashrc;

	echo "Done. Bye."
}

if [ "$1" == "--force" -o "$1" == "-f" ]; then
	dotfiles;
else
	read -p "This will overwrite existing files. Are you sure? (y/n) " -n 1;
	echo "";
	if [[ $REPLY =~ ^[Yy]$ ]]; then
		dotfiles;
	fi;
fi;
unset dotfiles;
