#!/usr/bin/env bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"
FILES=".bashrc .bash_profile .vimrc .vim .gitconfig .gitignore .inputrc .nvm/default-packages"

vscode() {
	echo "Creating symlink to ${1}/snippets..."
	rm -rf "${1}/snippets"
	ln -s "${DIR}/.vscode/snippets/" "${1}/snippets"

	echo "Creating symlink to ${1}/settings.json..."
	rm "${1}/settings.json"
	ln -s "${DIR}/.vscode/settings.json" "${1}/settings.json"
}

dotfiles() {
	for FILE in $FILES; do
		# create if doesn't exist
		if [ -e "$FILE" ]; then
			touch $HOME/$FILE
		fi

		# remove old version
		rm -r $HOME/$FILE

		# make new symlink
    echo "Creating symlink to $HOME/$FILE..."
    ln -s $DIR/$FILE $HOME/$FILE
	done

	# symlink vscode if it's istalled
	local MACOS=$HOME/"Library/Application Support/Code/User"
	local LINUX=$HOME/.config/Code/User

	if [ -d "$MACOS" ]; then
		vscode "$MACOS"
	elif [ -f "$LINUX" ]; then
		vscode "$LINUX"
	else echo "Can't find VS Code settings"
	fi

	touch $HOME/.hushlogin
	source $HOME/.bashrc;

	echo "Done. Bye."
}

if [ "$1" == "--force" -o "$1" == "-f" ]; then
	dotfiles;
else
	read -p "This will overwrite existing files. Are you sure? (y/n) " -n 1;
	echo "";
	if [[ $REPLY =~ ^[Yy]$ ]]; then
		dotfiles;
	fi;
fi;

unset DIR;
unset FILES;
